name: Create Issue on Workflow Failure

on:
  workflow_run:
    workflows: ["Decide-Lorca application"]
    types: [completed]

jobs:
  create-issue-on-failure:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion != 'success' }}

    steps:
      - name: Create Issue on Workflow Failure
        env:
          GITHUB_TOKEN: ${{ secrets.MY_GITHUB_TOKEN }}

        run: |
          # TÃ­tulo y cuerpo de la issue
          issue_title="Failure in CI - Decide"
          issue_body="El flujo de trabajo ha fallado en la rama main."

          # Crear la issue utilizando la API de GitHub
          curl -X POST \
            -H "Authorization: token $GITHUB_TOKEN" \
            -H "Content-Type: application/json" \
            -d '{"title": "'"$issue_title"'", "body": "'"$issue_body"'"}' \
            "https://api.github.com/repos/${{ github.repository }}/issues"
